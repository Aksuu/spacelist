<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
 <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" th:href="@{css/bootstrap.min.css}" /> 
 <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<title>Index page</title>
</head>
<body>

    <h1>Items</h1>
    <table class="table table-striped">
        <tr>
            <th>Header</th>
            <th>Description</th>
        </tr>
        <tr th:each = "item : ${items}">
            <td th:text="${item.header}"></td>
            <td th:text="${item.description}"></td>
        </tr>
    </table>

    <input id="search" type="text" placeholder="Search...">
    <button type="button" class="btn btn-success" id="searchBtn">Search</button>
    <div id="nasa-search">

<!-- <div class="row-area" th:each="Image: ${search}">
    <iframe id="resultImg" type="text/html" width="1080" height="1000" frameborder="0"></iframe>
</div> -->
  <div id="resultTitle">&nbsp;</div>
  <div id="resultDescription">&nbsp;</div>
</div>

<!-- Form for asking the APOD date -->
<form id="date-selection">
  <label for="image-date">Date:</label>
  <input type="date" id="image-date" class="form-control" />
  <div style="clear: both; display: block; height: 10px;"></div>
  <button type="button" class="btn btn-success" id="update">Submit</button>
</form>

<!-- The div for displaying the APOD results -->
<div id="nasa-apod">
    <iframe id="apodImg" type="text/html" width="1080" height="1000" frameborder="0"></iframe>
  <div id="apodTitle">&nbsp;</div>
  <div id="apodDescription">&nbsp;</div>
</div>

    <script>
// ----------- APOD script starts --------------

// Set the key needed for the API here
var apikey = "eouaU2byphnbSBMhS5Wh8CtwEt7QoDrA67CZOYou";

// Set the button to trigger the updateDate function
$(document).ready(function () {
  $("#update").click(updateDate);
});

// The function to fetch desired APOD according the date
function updateDate(event) {
  var date = $("#image-date").val();
  var url = apodUrlBuild(date);
  $.getJSON(url, function (response) {
    $("#apodImg").attr("src", response.hdurl);
    $("#apodTitle").html(response.title);
    $("#apodDescription").html(response.explanation);
  });
}

// Build the APOD url so that it includes the chosen date
function apodUrlBuild(date) {
  var finalUrl = "https://api.nasa.gov/planetary/apod";
  finalUrl += "?date=" + date + "&api_key=" + apikey;
  return finalUrl;
}
// ------------- APOD script ends ----------------

$(document).ready(function () {
  $("#searchBtn").click(showResults);
});

function showResults(event) {
  var inputWord = $("#search").val();
  var url = searchUrlBuild(inputWord);
  $.getJSON(url, function (response) {
    $("#resultImg").attr("src", response.collection.items[0].href);
    $("#resultTitle").html(response.collection.items[0].data[0].title);
    $("#resultDescription").html(response.collection.items[0].data[0].description);
  });
}

function searchUrlBuild(inputWord) {
  var finalSearchUrl = "https://images-api.nasa.gov/search?q=";
  finalSearchUrl += inputWord;
  return finalSearchUrl;
}

    </script>

</body>
</html>